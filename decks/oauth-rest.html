<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js ie6" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->  <html class="no-js" lang="en"> <!--<![endif]-->
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	
	<title></title>
	
	<meta name="description" content="A jQuery library for modern HTML presentations">
	<meta name="viewport" content="width=1024, user-scalable=no">
	
	<!-- Core and extension CSS files -->
	<link rel="stylesheet" href="../deck.js/core/deck.core.css">
	<link rel="stylesheet" href="../deck.js/extensions/goto/deck.goto.css">
	<link rel="stylesheet" href="../deck.js/extensions/menu/deck.menu.css">
	<link rel="stylesheet" href="../deck.js/extensions/navigation/deck.navigation.css">
	<link rel="stylesheet" href="../deck.js/extensions/status/deck.status.css">
	<link rel="stylesheet" href="../deck.js/extensions/hash/deck.hash.css">
	<link rel="stylesheet" href="../css/syntax.css">
	
	<!-- Theme CSS files (menu swaps these out) -->
    <link rel="stylesheet" href="../font-awesome/css/font-awesome.css">
    
    
	<link rel="stylesheet" id="style-theme-link" href="../themes/style/spring.css">
	<link rel="stylesheet" id="transition-theme-link" href="../deck.js/themes/transition/horizontal-slide.css">
	
	<script src="../deck.js/modernizr.custom.js"></script>
</head>

<body class="deck-container">

<div class="slide" id="slide1"><h1 id="toc_0">When and Why to Use OAuth2</h1>

<p>Dave Syer, 2012<br>
Twitter: @david_syer<br>
Email: <a href="mailto:dsyer@vmware.com">dsyer@vmware.com</a></p>

<p>(Securing REST-ful Web Services with OAuth2)</p>

</div><div class="slide" id="slide2"><h2 id="toc_1">Agenda</h2>

<ul>
<li>Why would I use <a href="http://en.wikipedia.org/wiki/OAuth#OAuth_2.0">OAuth2</a>?</li>
<li>If I was going to use Spring how would that look?</li>
<li>What&#39;s the easiest way to get something working?</li>
<li>Blog: <a href="">http://blog.cloudfoundry.org/2012/10/09/oauth-rest/</a></li>
</ul>

</div><div class="slide" id="slide3"><h2 id="toc_2">Introduction</h2>

<ul>
<li>There is a <a href="http://www.indeed.com/jobtrends?q=JSON+REST%2CSOAP+XML&amp;l=&amp;relative=1#shareCode">strong trend</a> distributed systems with
lightweight architectures</li>
</ul>

<p><img src="images/jobgraph_REST_SOAP.png" alt="job-trends"></p>

<ul>
<li>So what are people doing about security in such systems?</li>
</ul>

</div><div class="slide" id="slide4"><h2 id="toc_3">What is a Lightweight Service?</h2>

<ul>
<li>HTTP transport.</li>
<li>Text-based message content, usually <a href="http://en.wikipedia.org/wiki/JSON">JSON</a>.</li>
<li>Small, compact messages, and quick responses.</li>
<li>REST-ful, or at least inspired by the <a href="http://en.wikipedia.org/wiki/Representational_state_transfer">REST</a></li>
<li>Some degree of statelessness</li>
<li>Interoperability.</li>
</ul>

</div><div class="slide" id="slide5"><h2 id="toc_4">What Are the Security Requirements</h2>

<p>Identity and permissions:</p>

<ul>
<li>how is identity and permission information conveyed to a service?</li>
<li>how is it decoded and interpreted?</li>
<li>what data are needed to make the access decision (user accounts,
roles, ACLs etc.)?</li>
<li>how is the data managed: who is responsible for storing and
retrieving it?</li>
</ul>

</div><div class="slide" id="slide6"><h2 id="toc_5">HTTP Basic Authentication</h2>

<ul>
<li>something of a lowest common denominator</li>
<li>supported on practically all servers natively and out of the box</li>
<li>ubiquitous support on the client side in all languages</li>
</ul>

<p>Example:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">    $ curl &quot;https://$username:$password@myhost/resource&quot;
</code></pre></div>
</div><div class="slide" id="slide7"><h2 id="toc_6">So what&#39;s wrong with that?</h2>

<ul>
<li>Nothing, but...</li>
<li>Where do you get the credentials (the username and password)?</li>
<li>Fine for systems where all participants can share secrets securely</li>
<li>In practice that means small systems</li>
<li>Only supports username/password</li>
<li>Only covers authentication</li>
</ul>

</div><div class="slide" id="slide8"><h2 id="toc_7">User or Client Permissions</h2>

<ul>
<li>Finer-grained information about the authenticated party</li>
<li>Role-based access: very common, sometimes available in
server/container</li>
<li>Need to categorize user accounts, e.g. USER and ADMIN</li>
<li>Often business requirements are more complex</li>
</ul>

</div><div class="slide" id="slide9"><h2 id="toc_8">OAuth2</h2>

<p>Centralizing account management and permissions:</p>

<ul>
<li>OAuth 2.0 adds an extra dimension - more information for the access
decision</li>
<li>Standards always help in security</li>
<li>Lightweight - easy to <code>curl</code></li>
<li>Requires HTTPS for secure operation, but you can test with HTTP</li>
</ul>

</div><div class="slide" id="slide10"><h2 id="toc_9">Quick Introduction to OAuth2</h2>

<blockquote>
<p>A Client application, often web application, acts on behalf of a
User, but with the User&#39;s approval</p>
</blockquote>

<ul>
<li>Authorization Server</li>
<li>Resource Server</li>
<li>Client application</li>
</ul>

<p>Common examples of Authorization Servers on the internet:</p>

<ul>
<li><a href="http://developers.facebook.com">Facebook</a> - Graph API</li>
<li><a href="http://code.google.com/apis/accounts/docs/OAuth2.html">Google</a> - Google APIs</li>
<li><a href="http://uaa.cloudfoundry.com">Cloud Foundry</a> - Cloud Controller</li>
</ul>

</div><div class="slide" id="slide11"><h2 id="toc_10">OAuth2 and the Lightweight Service</h2>

<p>Example command line Client:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">$ curl -H &quot;Authorization: Bearer $TOKEN&quot; https://myhost/resource
</code></pre></div>
<ul>
<li><code>https://myhost</code> is a Resource Server</li>
<li><code>TOKEN</code> is a Bearer Token</li>
<li>it came from an Authorization Server</li>
</ul>

</div><div class="slide" id="slide12"><h2 id="toc_11">OAuth2 Key Features</h2>

<ul>
<li>Extremely simple for clients</li>
<li>Access tokens carry information (beyond identity)</li>
<li><p>Resource Servers are free to interpret tokens</p></li>
<li><p>Example token contents:</p>

<ul>
<li>Client id</li>
<li>Resource id (audience)</li>
<li>User id</li>
<li>Role assignments</li>
</ul></li>
</ul>

</div><div class="slide" id="slide13"><h2 id="toc_12">UAA Bearer Tokens</h2>

<ul>
<li>OAuth 2.0 tokens are opaque to clients</li>
<li>But they carry important information to Resource Servers</li>
<li><p>Example of implementation (from Cloud Foundry UAA, JWT = signed,
base64-encoded, JSON):</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">{  &quot;client_id&quot;:&quot;vmc&quot;,
   &quot;exp&quot;:1346325625,
   &quot;scope&quot;:[&quot;cloud_controller.read&quot;,&quot;openid&quot;,&quot;password.write&quot;],
   &quot;aud&quot;:[&quot;openid&quot;,&quot;cloud_controller&quot;,&quot;password&quot;],
   &quot;user_name&quot;:&quot;vcap_tester@vmware.com&quot;,
   &quot;user_id&quot;:&quot;52147673-9d60-4674-a6d9-225b94d7a64e&quot;,
   &quot;email&quot;:&quot;vcap_tester@vmware.com&quot;,
   &quot;jti&quot;:&quot;f724ae9a-7c6f-41f2-9c4a-526cea84e614&quot; }
</code></pre></div></li>
</ul>

</div><div class="slide" id="slide14"><h2 id="toc_13">Obtaining a Client Credentials Token</h2>

<p>A client can act in its own right (not on behalf of a user):</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">$ curl &quot;https://myclient:mysecret@uaa.cloudfoundry.com/oauth/tokens&quot; 
    -d grant_type=client_credentials -d client_id=myclient
</code></pre></div>
<p>Result:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">{
  access_token: FUYGKRWFG.jhdfgair7fylzshjg.o98q47tgh.fljgh,
  expires_in: 43200,
  client_id: myclient,
  scope: uaa.admin
}
</code></pre></div>
</div><div class="slide" id="slide15"><h2 id="toc_14">Web Application Client</h2>

<p>The Client wants to access a Resource on behalf of the User</p>

<p><img src="images/oauth-web-client.png" alt="oauth-web-client"></p>

</div><div class="slide" id="slide16"><h2 id="toc_15">Obtaining a User Token</h2>

<p>A client can act on behalf of a user (e.g. <code>authorization_code</code> grant):</p>

<p><img src="images/auth-code-flow.png" alt="auth-code-flow"></p>

</div><div class="slide" id="slide17"><h2 id="toc_16">Authorization Code Grant Summary</h2>

<ol>
<li><p>Authorization Server authenticates the User</p></li>
<li><p>Client starts the authorization flow and obtain User&#39;s approval</p></li>
<li><p>Authorization Server issues an authorization code (opaque one-time
token)</p></li>
<li><p>Client exchanges the authorization code for an access token.</p></li>
</ol>

</div><div class="slide" id="slide18"><h2 id="toc_17">Role of Client Application</h2>

<ul>
<li>Register with Authorization Server (get a <code>client_id</code> and maybe a
<code>client_secret</code>)</li>
<li>Do not collect user credentials</li>
<li>Obtain a token (opaque) from Authorization Server

<ul>
<li>On its own behalf - <code>client_credentials</code></li>
<li>On behalf of a user</li>
</ul></li>
<li>Use it to access Resource Server</li>
</ul>

</div><div class="slide" id="slide19"><h2 id="toc_18">Role of Resource Server</h2>

<ol>
<li>Extract token from request and decode it</li>
<li>Make access control decision

<ul>
<li>Scope</li>
<li>Audience</li>
<li>User account information (id, roles etc.)</li>
<li>Client information (id, roles etc.)</li>
</ul></li>
<li>Send 403 (FORBIDDEN) if token not sufficient</li>
</ol>

</div><div class="slide" id="slide20"><h2 id="toc_19">Role of the Authorization Server</h2>

<ol>
<li>Grant tokens</li>
<li>Interface for users to confirm that they authorize the Client to act
on their behalf</li>
<li>Authenticate users (<code>/authorize</code>)</li>
<li>Authenticate clients (<code>/token</code>)</li>
</ol>

<p>#1 and #4 are covered thoroughly by the spec; #2 and #3 not (for
good reasons).</p>

</div><div class="slide" id="slide21"><h2 id="toc_20">More on Scopes</h2>

<p>Per the spec they are arbitrary strings.  The Authorization Server and
the Resource Servers agree on the content and meanings.</p>

<p>Examples:</p>

<ul>
<li>Google: <code>https://www.googleapis.com/auth/userinfo.profile</code></li>
<li>Facebook: <code>email</code>, <code>read_stream</code>, <code>write_stream</code></li>
<li>UAA: <code>cloud_controller.read</code>, <code>cloud_controller.write</code>, <code>scim.read</code>,
<code>openid</code></li>
</ul>

<p>Authorization Server has to decide whether to grant a token to a given
client and user based on the requested scope (if any).</p>

</div><div class="slide" id="slide22"><h2 id="toc_21">UAA Scopes</h2>

<ul>
<li>UAA scopes are actually Groups in the User accounts</li>
<li><p><code>GET /Groups</code>, <code>Get /Users/{id}</code></p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">{
  &quot;id&quot;: &quot;73ba999e-fc34-49eb-ac26-dc8be52c1d82&quot;,
  &quot;meta&quot;: {...},
  &quot;userName&quot;: &quot;marissa&quot;,
  &quot;groups&quot;: [
   ...
   {
      &quot;value&quot;: &quot;23a71835-c7ce-43ac-b511-c84d3ae8e788&quot;,
      &quot;display&quot;: &quot;uaa.user&quot;,
      &quot;membershipType&quot;: &quot;DIRECT&quot;
    }
  ],
}
</code></pre></div></li>
</ul>

</div><div class="slide" id="slide23"><h2 id="toc_22">Special Mention for Vmc</h2>

<p>The UAA authenticates requests from <code>vmc</code> in a special way:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">$ curl https://uaa.cloudfoundry.com/oauth/authorize
    -d response_type=token -d client_id=vmc
    -d redirect_uri=https:uaa.cloudfoundry.com/redirect/vmc
    -d source=credentials
    -d username=$username -d password=$password
</code></pre></div>
<p>Result:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">302 FOUND
...
Location: https://uaa.cloudfoundry.com/redirect/vmc#access_token=FUYGKRWFG.jhdfgair7fylzshjg.o98q47tgh.fljgh...  
</code></pre></div>
</div><div class="slide" id="slide24"><h2 id="toc_23">Authentication and the Authorization Server</h2>

<ul>
<li>Authentication (checking user credentials) is orthogonal to
authorization (granting tokens)</li>
<li>They don&#39;t have to be handled in the same component of a large
system</li>
<li>Authentication is often deferred to existing systems (SSO)</li>
<li>Authorization Server has to be able to authenticate the OAuth
endpoints (<code>/authorize</code> and <code>/token</code>)</li>
<li>It <em>does not</em> have to collect credentials (except for
<code>grant_type=password</code>)</li>
</ul>

</div><div class="slide" id="slide25"><h2 id="toc_24">Cloud Foundry UAA Authorization Server</h2>

<p><img src="images/cf-uaa.png" alt="cf-uaa"></p>

</div><div class="slide" id="slide26"><h2 id="toc_25">Cloud Foundry UAA as a General Purpose Solution</h2>

<ul>
<li><a href="http://github.com/cloudfoundry/uaa">User Account and Authentication Service</a> is part of <a href="http://www.cloudfoundry.com">Cloud
Foundry</a></li>
<li>open source and fairly generic</li>
<li>sample apps (including login server)</li>
<li>wrapper for <a href="http://github.com/springsource/spring-security-oauth">Spring Security OAuth</a></li>
<li>runs in a servlet container (e.g. tomcat)</li>
<li>easy for Spring developers to install and customize</li>
<li>look for UAA blogs at <a href="">http://blog.cloudfoundry.org</a> (and .com)</li>
</ul>

</div><div class="slide" id="slide27"><h2 id="toc_26">UAA OAuth Implementation</h2>

<p>UAA makes some explicit choices where the spec allows it, and also
adds some useful features:</p>

<ul>
<li>Client registration validation, e.g. implicit has no secret</li>
<li>Client has separate allowed scopes for user tokens and client tokens
(if allowed).</li>
<li>User account management: groups = scopes, period-separated</li>
<li>JWT tokens, signed but not encoded, includes audience
(a.k.a. <code>resource_id</code>)</li>
<li><code>/userinfo</code> endpoint for remote authentication (SSO)</li>
<li>Auto-approve for client apps that are part of platform</li>
<li>Special authentication channels for <code>/authorize</code>:

<ul>
<li><code>source=credentials</code> - used by vmc</li>
<li><code>source=login</code> - used by Login Server</li>
<li>(Login Server) autologin via <code>code=...</code></li>
</ul></li>
</ul>

</div><div class="slide" id="slide28"><h2 id="toc_27">Alternatives to OAuth2</h2>

<ul>
<li>OAuth 1.0a</li>
<li>SAML</li>
<li>CAS</li>
<li>Custom solution, e.g. HMAC signed requests</li>
<li>Extensions to OAuth2</li>
</ul>

</div><div class="slide" id="slide29"><h2 id="toc_28">In Conclusion</h2>

<ul>
<li>Lightweight services demand lightweight infrastructure</li>
<li>Security is important, but should be unobtrusive</li>
<li>OAuth 2.0 is a standard, and has a lot of useful features</li>
<li><a href="http://github.com/springsource/spring-security-oauth">Spring Security OAuth</a> aims to be a complete solution at
the framework level</li>
<li>Cloud Foundry <a href="http://github.com/cloudfoundry/uaa">UAA</a> adds some implementation details and makes
some concrete choices</li>
</ul>

</div><div class="slide" id="slide30"><h2 id="toc_29">Links</h2>

<ul>
<li><a href="">http://github.com/springsource/spring-security-oauth</a></li>
<li><a href="">http://github.com/cloudfoundry/uaa</a></li>
<li><a href="">http://blog.cloudfoundry.org</a></li>
<li><a href="">http://blog.cloudfoundry.com</a></li>
<li><a href="">http://blog.springsource.org</a></li>
<li><a href="">http://dsyerstatic.cloudfoundry.com/preso/decks/oauth-rest.md.html</a></li>
<li>Testing Web Applications with Spring 3.2  Register: <a href="">http://www.springsource.org/node/3800</a></li>
<li>Twitter: @david_syer<br></li>
<li>Email: <a href="mailto:dsyer@vmware.com">dsyer@vmware.com</a></li>
</ul>
</div>


<a href="#" class="deck-prev-link" title="Previous">&#8592;</a>
<a href="#" class="deck-next-link" title="Next">&#8594;</a>

<p id="footer" class="deck-status">
	<span class="deck-status-current"></span>/<span class="deck-status-total"></span>
</p>

<form action="." method="get" class="goto-form">
	<label for="goto-slide">Go to slide:</label>
	<input type="number" name="slidenum" id="goto-slide">
	<input type="submit" value="Go">
</form>

<a href="." title="Permalink to this slide" class="deck-permalink">#</a>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.js"></script>
<script>window.jQuery || document.write('<script src="../deck.js/jquery.min.js"><\/script>')</script>

<!-- Deck Core and extensions -->
<script src="../deck.js/core/deck.core.js"></script>
<script src="../deck.js/extensions/menu/deck.menu.js"></script>
<script src="../deck.js/extensions/goto/deck.goto.js"></script>
<script src="../deck.js/extensions/status/deck.status.js"></script>
<script src="../deck.js/extensions/navigation/deck.navigation.js"></script>
<script src="../deck.js/extensions/hash/deck.hash.js"></script>

<script type="text/javascript">
$(function() {
	// Deck initialization
	$.deck('.slide');
	
	$('#style-themes').change(function() {
		$('#style-theme-link').attr('href', $(this).val());
	});
	
	$('#transition-themes').change(function() {
		$('#transition-theme-link').attr('href', $(this).val());
	});

    $('pre').click(function (){
	$(this).toggleClass('highlighted');
    });
});
</script>

</body>
</html>
