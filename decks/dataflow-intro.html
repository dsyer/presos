
<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js ie6" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->  <html class="no-js" lang="en"> <!--<![endif]-->
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	
	<title></title>
	
	<meta name="description" content="A jQuery library for modern HTML presentations">
	<meta name="viewport" content="width=1024, user-scalable=no">
	
	<!-- Core and extension CSS files -->
	<link rel="stylesheet" href="../deck.js/core/deck.core.css">
	<link rel="stylesheet" href="../deck.js/extensions/goto/deck.goto.css">
	<link rel="stylesheet" href="../deck.js/extensions/menu/deck.menu.css">
	<link rel="stylesheet" href="../deck.js/extensions/navigation/deck.navigation.css">
	<link rel="stylesheet" href="../deck.js/extensions/status/deck.status.css">
	<link rel="stylesheet" href="../deck.js/extensions/hash/deck.hash.css">
	<link rel="stylesheet" href="../css/syntax.css">
	
	<!-- Theme CSS files (menu swaps these out) -->
    <link rel="stylesheet" href="../font-awesome/css/font-awesome.css">
    
    
	<link rel="stylesheet" id="style-theme-link" href="../themes/style/spring.css">
	<link rel="stylesheet" id="transition-theme-link" href="../deck.js/themes/transition/fade.css">
	
	<script src="../deck.js/modernizr.custom.js"></script>
</head>

<body class="deck-container">

<div class="slide" id="slide1"><h1 id="messaging-microservices-with-spring-cloud">Messaging Microservices with Spring Cloud</h1>

<p>Dave Syer, 2016<br>
Twitter: @david_syer<br>
Email: <a href="mailto:dsyer@pivotal.io">dsyer@pivotal.io</a></p>

</div><div class="slide" id="slide2"><h2 id="agenda">Agenda</h2>

<ul>
<li>What is a Messaging Microservice?</li>
<li>Why do I care?</li>
<li>How do I make them and deploy them?</li>
<li>What about Streaming and Batch Processing?</li>
</ul>

</div><div class="slide" id="slide3"><h2 id="microservices">Microservices</h2>

<p><em>Life after REST</em></p>

</div><div class="slide" id="slide4"><h2 id="messaging">Messaging</h2>

<p><em>Patterns:</em></p>

<ul>
<li>spatial decoupling (aka communication)</li>
<li>temporal decoupling (aka buffering)</li>
<li>logical decoupling (aka routing)</li>
</ul>

<blockquote>
<p><em>Conclusion:</em> There is a range of applications and problems to
which messaging is an effective solution.</p>
</blockquote>

</div><div class="slide" id="slide5"><h2 id="philosophy">Philosophy</h2>

<blockquote>
<p><em>Simple things should be easy, and</em>
<em>complex things should be possible.</em></p>
</blockquote>

<hr>

<p>Alan Kay</p>

</div><div class="slide" id="slide6"><h2 id="a-simple-streaming-application">A Simple Streaming Application</h2>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@EnableBinding</span><span class="o">(</span><span class="n">Source</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@SpringBootApplication</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Application</span> <span class="o">{</span>

  <span class="nd">@Autowired</span>
  <span class="n">Source</span> <span class="n">source</span><span class="o">;</span>

  <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">&quot;/&quot;</span><span class="o">,</span> <span class="n">method</span><span class="o">=</span><span class="n">POST</span><span class="o">)</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">send</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">source</span><span class="o">.</span><span class="na">output</span><span class="o">()</span>
      <span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">MessageBuilder</span><span class="o">.</span><span class="na">withPayload</span><span class="o">(</span><span class="s">&quot;Hello World&quot;</span><span class="o">).</span><span class="na">build</span><span class="o">);</span>
    <span class="k">return</span> <span class="s">&quot;OK&quot;</span><span class="o">;</span>
  <span class="o">}</span>

<span class="o">}</span>
</code></pre></div>
</div><div class="slide" id="slide7"><h2 id="what-39-s-a-source">What&#39;s a Source?</h2>

<p><em>Answer:</em> it&#39;s an interface...</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Source</span> <span class="o">{</span>

  <span class="n">String</span> <span class="n">OUTPUT</span> <span class="o">=</span> <span class="s">&quot;output&quot;</span><span class="o">;</span>

  <span class="nd">@Output</span><span class="o">(</span><span class="n">Source</span><span class="o">.</span><span class="na">OUTPUT</span><span class="o">)</span>
  <span class="n">MessageChannel</span> <span class="nf">output</span><span class="o">();</span>

<span class="o">}</span>
</code></pre></div>
</div><div class="slide" id="slide8"><h2 id="source-sending-messages">Source Sending Messages</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text">   +--------+     +---------------------------+
   | Source |----&gt;| &quot;output&quot;                  |
   +--------+     +---------------------------+
</code></pre></div>
</div><div class="slide" id="slide9"><h2 id="add-a-sink">Add a Sink</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text">   +--------+     +---------------------------+     +---------+
   | Source |----&gt;| &quot;output&quot;                  |----&gt;| Sink    |
   +--------+     +---------------------------+     +---------+
</code></pre></div>
</div><div class="slide" id="slide10"><h2 id="enable-all-the-things">Enable All the Things</h2>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@EnableBinding</span><span class="o">(</span><span class="n">Source</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">...</span>
<span class="nd">@EnableBinding</span><span class="o">(</span><span class="n">Sink</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">...</span>
<span class="nd">@EnableBinding</span><span class="o">(</span><span class="n">Processor</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">...</span>
</code></pre></div>
<p>or even</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">@EnableBinding(MyCoffeeShop.class)
</code></pre></div>
</div><div class="slide" id="slide11"><h2 id="consuming-messages">Consuming Messages</h2>

<p>You can use the <code>MessageChannel</code> interfaces (e.g. inject a <code>SubscribableChannel</code> and subscribe to it).</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@EnableBinding</span><span class="o">(</span><span class="n">Processor</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TransformProcessor</span> <span class="o">{</span>

  <span class="nd">@Transformer</span><span class="o">(</span><span class="n">inputChannel</span> <span class="o">=</span> <span class="n">Processor</span><span class="o">.</span><span class="na">INPUT</span><span class="o">,</span> <span class="n">outputChannel</span> <span class="o">=</span> <span class="n">Processor</span><span class="o">.</span><span class="na">OUTPUT</span><span class="o">)</span>
  <span class="kd">public</span> <span class="n">Object</span> <span class="nf">transform</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">message</span><span class="o">.</span><span class="na">toUpper</span><span class="o">();</span>
  <span class="o">}</span>

<span class="o">}</span>
</code></pre></div>
</div><div class="slide" id="slide12"><h2 id="consuming-messages">Consuming Messages</h2>

<p><em>Or</em> you can use a <code>@StreamListener</code> (more like <code>@RequestMapping</code>):</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@EnableBinding</span><span class="o">(</span><span class="n">Processor</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TransformProcessor</span> <span class="o">{</span>

  <span class="o">...</span>

  <span class="nd">@StreamListener</span><span class="o">(</span><span class="n">Processor</span><span class="o">.</span><span class="na">INPUT</span><span class="o">)</span>
  <span class="nd">@SendTo</span><span class="o">(</span><span class="n">Processor</span><span class="o">.</span><span class="na">OUTPUT</span><span class="o">)</span>
  <span class="kd">public</span> <span class="n">VoteResult</span> <span class="nf">handle</span><span class="o">(</span><span class="n">Vote</span> <span class="n">vote</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nf">record</span><span class="o">(</span><span class="n">vote</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<p>(With <code>@StreamListener</code> you also get support for Reactor and RxJava.)</p>

</div><div class="slide" id="slide13"><h2 id="tasks-as-well">Tasks as Well</h2>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@SpringBootApplication</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Task</span> <span class="o">{</span>

  <span class="nd">@Bean</span>
  <span class="kd">public</span> <span class="nf">ApplicationRunner</span><span class="o">(</span><span class="n">Source</span> <span class="n">source</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">app</span> <span class="o">-&gt;</span> <span class="o">{</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Hello World&quot;</span><span class="o">);</span> <span class="o">};</span>
  <span class="o">}</span>

  <span class="o">...</span>
<span class="o">}</span>
</code></pre></div>
</div><div class="slide" id="slide14"><h2 id="enable-that-task">Enable that Task!</h2>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@EnableTask</span>
<span class="nd">@SpringBootApplication</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Task</span> <span class="o">{</span>

  <span class="nd">@Bean</span>
  <span class="kd">public</span> <span class="nf">ApplicationRunner</span><span class="o">(</span><span class="n">Source</span> <span class="n">source</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">app</span> <span class="o">-&gt;</span> <span class="o">{</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Hello World&quot;</span><span class="o">);</span> <span class="o">};</span>
  <span class="o">}</span>

  <span class="o">...</span>
<span class="o">}</span>
</code></pre></div>
</div><div class="slide" id="slide15"><h2 id="spring-cloud-data-flow">Spring Cloud Data Flow</h2>

<blockquote>
<p><em>A programming and operating model for</em>
<em>streams and tasks on a structured platform.</em></p>
</blockquote>

<p><em>Components:</em></p>

<ul>
<li>server (REST and UI)</li>
<li>store (RDBMS and redis)</li>
<li>shell</li>
<li>apps (streams and tasks)</li>
<li>platform</li>
</ul>

</div><div class="slide" id="slide16"><h2 id="structured-platform">Structured Platform?</h2>

<p>It&#39;s an SPI. <em>Examples:</em></p>

<ul>
<li>local (in or out of process)</li>
<li>cloud foundry</li>
<li>YARN</li>
<li>kubernetes</li>
<li>mesos</li>
</ul>

</div><div class="slide" id="slide17"><h2 id="architecture">Architecture</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text">  +---------------------------------+
  |            Client               | (shell or browser)
  +---------------------------------+
                |^
  Platform      v|                    (cf, k8s, mesos, etc.)
  +---------------------------------+
  |       +------+ +------+         |
  |       |Server| |  DB  |         |
  |       +------+ +------+         |
  | +----+----+----+----+----+----+ |
  | |    |    |Apps|    |    |    | | (streams and tasks)
  | +-----------------------------+ |
  | |         Transport           | | (rabbit, kafka, etc.)
  +---------------------------------+
</code></pre></div>
</div><div class="slide" id="slide18"><h2 id="streams-and-tasks">Streams and Tasks</h2>

<p>Streams have a DSL, e.g. <code>http | transform | hdfs</code>, but fundamentally
they are just apps sending each other messages. Each node in the
pipeline is a Spring Boot app using Spring Cloud Stream.</p>

<p>Tasks are short- (or finite-) lived apps. Data Flow orchestrates them
and uses Spring Cloud Task to record their exit status.</p>

</div><div class="slide" id="slide19"><h2 id="eof">EOF</h2>

<ul>
<li><a href="http://github.com/spring-cloud/spring-cloud-stream">http://github.com/spring-cloud/spring-cloud-stream</a></li>
<li><a href="http://github.com/spring-cloud/spring-cloud-task">http://github.com/spring-cloud/spring-cloud-task</a></li>
<li><a href="http://github.com/spring-cloud/spring-cloud-dataflow">http://github.com/spring-cloud/spring-cloud-dataflow</a></li>
<li><a href="mailto:dsyer@pivotal.io">dsyer@pivotal.io</a></li>
<li>@david_syer</li>
</ul>
</div>

<a href="#" class="deck-prev-link" title="Previous">&#8592;</a>
<a href="#" class="deck-next-link" title="Next">&#8594;</a>

<p id="footer" class="deck-status">
	<span class="deck-status-current"></span>/<span class="deck-status-total"></span>
</p>

<form action="." method="get" class="goto-form">
	<label for="goto-slide">Go to slide:</label>
	<input type="number" name="slidenum" id="goto-slide">
	<input type="submit" value="Go">
</form>

<a href="." title="Permalink to this slide" class="deck-permalink">#</a>

<script src="/deck.js/jquery-1.7.2.min.js"></script>
<script>window.jQuery || document.write('<script src="../deck.js/jquery.min.js"><\/script>')</script>

<!-- Deck Core and extensions -->
<script src="../deck.js/core/deck.core.js"></script>
<script src="../deck.js/extensions/menu/deck.menu.js"></script>
<script src="../deck.js/extensions/goto/deck.goto.js"></script>
<script src="../deck.js/extensions/status/deck.status.js"></script>
<script src="../deck.js/extensions/navigation/deck.navigation.js"></script>
<script src="../deck.js/extensions/hash/deck.hash.js"></script>

<script type="text/javascript">
$(function() {
	// Deck initialization
	$.deck('.slide');
	
	$('#style-themes').change(function() {
		$('#style-theme-link').attr('href', $(this).val());
	});
	
	$('#transition-themes').change(function() {
		$('#transition-theme-link').attr('href', $(this).val());
	});

    $('pre').click(function (){
	$(this).toggleClass('highlighted');
    });
});
</script>

</body>
</html>
